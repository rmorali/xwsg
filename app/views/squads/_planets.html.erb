<% @planets.each do |planet| %>
  <% pos_x = ( planet.x + @map_x_adjust ) * @map_ratio %>
  <% pos_y = ( planet.y + @map_y_adjust ) * @map_ratio %>

  <div id="images" style="position: absolute; left:<%= pos_x %>px; top:<%= pos_y %>px; z-index: 5">
    <%= image_tag (planet.image), style: "width: 50px" %>
  </div>

  <div id="wormholes" style="position: absolute; left:<%= pos_x %>px; top:<%= pos_y - 60 %>px; z-index: -10">
    <info class="tooltip">
    <tip>
      <%= planet.wormhole_to if planet.wormhole? %></tip>
      <%= image_tag ('wormhole.gif'), style: "width: 100px" if planet.wormhole? %>
    </info>
  </div>

  <div id="names" style="position: absolute; left:<%= pos_x %>px; top:<%= pos_y - 25 %>px" >
    <span style="color: white; font-weight: bold; font-size: 12px">
      <%= planet.name %>
    </span>
  </div>

  <div id="planet_income" style="position:absolute; left:<%= pos_x + 45 %>px; top:<%= pos_y - 5 %>px;z-index: 15; white-space: nowrap">
    <span style="color:gray; font-size: 10px; font-weight: bold">
      <info class="tooltip">
      <tip>Income m√°ximo</tip>
        <%= planet.income %>
      </info>
    </span>
  </div>

  <div id="squad_income" style="position:absolute; left:<%= pos_x - 20 %>px; top:<%= pos_y - 5 %>px;z-index: 15; white-space: nowrap">
    <span style="color:yellow;font-size: 10px;font-weight: bold">
      <info class="tooltip">
      <tip>Income ao squad</tip>
        <%= SetIncome.new(@squad, planet).current %>
      </info>
    </span>
  </div>

  <div id="fleets" class="fleets" style="position:absolute; left:<%= pos_x + 40 %>px; top:<%= pos_y - 3 %>px">
    <% planet.fleets_seen_by(@squad).reject { |f| !f.carrier.nil? }.each do |fleet| %>
      <!-- <span style="<%= style(fleet) %>" onclick=showDiv('edit_box','15%','10%')> -->
      <info class="tooltip">
      <tip><%= raw tip(fleet) %></tip>
        <% if fleet.squad == @squad && @round.strategy? && !@squad.ready? && !fleet.in_production? %>
          <a href = "" onclick="window.open('/fleets/<%= fleet.id %>/edit','<%= fleet.name %> - <%= fleet.planet %>', 'toolbar=no, location=no, scrollbars=yes, resizable=yes, width=450, height=400')">
        <% end %>
          <span style="<%= style(fleet) %>">
            <%= show(fleet) %>
          </span>
        </a>
      </info>
      <span style="color: white">
          <%= "--> #{fleet.destination.name}" if fleet.destination %>
      </span>
      <!--  <%= link_to show(fleet), edit_fleet_path(fleet), remote: true, style: style(fleet) %> -->

      <% fleet.cargo.each do |cargo| %>
        <br>
        <span style="<%= style(cargo) %>">
          &nbsp &nbsp <%= show(cargo) %>
        </span>
      <% end %>
      <br>
    <% end %>

    <% if @round.strategy? %>
      <% planet.fleets_seen_by_radar(@squad).each do |fleet| %>
        <info class="tooltip">
        <tip>- Detectado por radar</tip>
          <span style="<%= style(fleet) %>; opacity: 0.9">
            <%= show(fleet) %>
          </span>
        </info>
        <br>
      <% end %>
    <% end %>

    <% planet.fog_seen_by(@squad).reject { |f| !f.carrier.nil? || f.final_quantity <= 0 }.each do |fleet| %>
      <info class="tooltip">
      <tip>- Enfrentado no turno: <%= fleet.round.number %></tip>
        <span style="<%= style(fleet) %>; opacity: 0.3">
          <%= show_fog(fleet) %>
        </span>
        <% fleet.cargo.each do |cargo| %>
          <br>
          <span style="<%= style(cargo) %>; opacity: 0.3">
            &nbsp &nbsp <%= show_fog(cargo) %>
          </span>
        <% end %>
      </info>
      <br>
   <% end %>
  </div>

<% end %>

<%= render partial: 'fog' %>
